<html>
	<head>
		<script src=https://teikn-js.googlecode.com/svn-history/r23/trunk/libraries/kinetic-v3.6.0.js></script>
		<script>
			//drawing layer for shapes, needs to be added to stage to get rendered
			//var shapesLayer = new Kinetic.Layer();
			var block = [];
			var blockSide = 4;
			var gameHeight = 0;
			var gameWidth = 0;
			var canvas;
			var context;
			var angle = 45;
			var power = 100;
			var damage = 50;
			var firstShot = true;
			var shapesLayer = new Kinetic.Layer();
			
			var requestAnimationFrame =  
				window.requestAnimationFrame ||
				window.webkitRequestAnimationFrame ||
				window.mozRequestAnimationFrame ||
				window.msRequestAnimationFrame ||
				window.oRequestAnimationFrame ||
				function(callback) {
				  return setTimeout(callback, 1000);
				};
			
			function calcDistance(vel, ang, gra) {
				var dis = (Math.pow(vel, 2) * Math.sin(2 * ang)) / g;
				return dis;
			}
			
			function calcTimeOfFlight(vel, ang, gra, dis) {
				var tim = dis / (vel * Math.cos(ang));
				return tim;
			}
			
			function heightAtX(origY, x, ang, gra, vel) {
				var y = origY + (x * Math.tan(ang)) - ((gra * Math.pow(x, 2)) / (2 * Math.pow(vel * Math.cos(ang), 2)));
				return y;
			}
			
			function velocityAtX(vel, gra, x, ang) {
				var vel = Math.sqrt(Math.pow(vel, 2) - (2 * gra * x * Math.tan(ang)) + Math.pow((gra * x) / (vel * Math.cos(ang)), 2));
				return vel;
			}
			
			function toDegrees (angle) {
			  return angle * (180 / Math.PI);
			}

			function toRadians (angle) {
			  return angle * (Math.PI / 180);
			}
			
			function noCollision(y, groundY) {
				if (y < groundY) {
					return true;
				}
				return false;
			}
			
			var animate = function() {
				var circleColor;
						
				globX++;
				globY = groundCoords[cannonX] - heightAtX(0, globX - cannonX, toRadians(angle), 10, power);
				
				//context.clearRect(myCircle.x - myCircle.radius - 1, myCircle.y - myCircle.radius - 1, myCircle.radius * 2 + 2, myCircle.radius * 2 + 2);
						
				myCircle.x = globX;		
				myCircle.y = globY;
				
				var redValue = 255 - globX;
				var blueValue = globX;
				var opacity = 0.9;
				
				if (noCollision(globY, groundCoords[globX])) {
					circleColor = "rgba(" + redValue + ", 0, " + blueValue + ", " + opacity + ")";
					drawCircle(myCircle, circleColor);
					window.requestAnimationFrame(animate);
				} else {
					myCircle.radius = 25;
					circleColor = 'black';
					drawCircle(myCircle, circleColor);
				}
			}
			
			function shoot() {
				if (firstShot) {
					NewGame();
					firstShot = false;
				}
			
				angle = document.getElementById("angle").value;
				power = document.getElementById("power").value;
				wind = document.getElementById("wind").value;
				
				//animate();
			}
			
			function NewGame() {
				gameHeight = document.getElementById('canvas').height;
				gameWidth = document.getElementById('canvas').width;
				
				var stage = new Kinetic.Stage("container", gameWidth, gameHeight);
				var e = document.getElementById("container");
				
				e.style.width = gameWidth;
				e.style.height = gameHeight;
				
				canvas = document.getElementById('canvas');
				context = canvas.getContext('2d');
				
				var blockIndex = 0;
				
			  	for (cy = 0; cy < gameHeight; cy += blockSide + 1) {
			  		for (cx = 0; cx < gameWidth; cx += blockSide + 1) {
			  			(function() {
			  				var x = cx;
			  				var y = cy;
			  			
							block[blockIndex] = new Kinetic.Shape(function() {    
				
								context.save();
								
								context.beginPath();
								context.moveTo(x, y);
								context.lineTo(x + blockSide, y);
								context.lineTo(x + blockSide, y + blockSide);
								context.lineTo(x, y + blockSide);
								context.closePath();
								context.fillStyle = "white";
								context.fill();		
								
								context.restore();
							});
							shapesLayer.add(block[blockIndex]);
						})();
						blockIndex++;
					}
				}
			  	stage.add(shapesLayer);
			  	shapesLayer.draw();
			}
		</script>
	</head>
<body bgcolor="black">// onmousedown="return false;">
		<table border="0" align="center">
			<tr>
				<td colspan="4">
					<p align="center">
						<font size="5" face="arial" color="aliceblue">
							Ballistica
						</font>
					</p>
				</td>
			</tr>	        
			<tr>
				<td>
					<p align="center">
						<font size="2" face="arial" color="aliceblue">
							Angle: <input type="text" id="angle" value="45" name="angle" size="3">&deg;
						</font>
					</p>
				</td>
				<td>
					<p align="center">
						<font size="2" face="arial" color="aliceblue">
							Force: <input type="text" id="power" value="100" name="force" size="3">%
						</font>
					</p>
				</td>
				<td>
					<p align="center">
						<font size="2" face="arial" color="aliceblue">
							Wind: <input type="text" id="wind" value="0" name="wind" size="3">mph
						</font>
					</p>
				</td>
				<td>
					<p align="center">
						<font size="2" face="arial" color="aliceblue">
							<button onclick="shoot();">Shoot!</button>
						</font>
					</p>
				</td>
			</tr>
			<tr>
				<td colspan="4">
					<div id="container" align="center">
						<canvas id="canvas" height="300" width="400" align="center">
					</div>
				</td>
			</tr>	 
			<tr>
				<td colspan="4">
					<p align="right">
						<font size="2" face="arial" color="aliceblue" >
							//GM &copy; 2015
						</font>
					</p>
				</td>
			</tr>	
		</table>	
	</body>
</html>
